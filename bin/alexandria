#!/usr/bin/env ruby
# coding: UTF-8

require_relative '../lib/alexandria'
require 'clive'
require 'pp'

LIB = Alexandria::Library.new File.expand_path(ENV["ALEXANDRIA_LIBRARY"])

class Alexandria::CLI < Clive

  module Helpers
    def check(bool)
      bool ? "✓" : "✗"
    end
    
    def find_device
      Alexandria::Device.new(".")
    end
  end
  
  command :add, arg: '<book>' do
    action do
      LIB.add! book
    end
  end
  
  command :list do
    bool :long
  
    action do
      device = find_device
      
      LIB.authors.each do |author, books|
        puts author.bold
        
        books.each do |book|
          puts " #{check device.has?(book)} #{book.title}"
        end
        
        puts ""
      end
    end
  end
  
  command :sync, arg: '<path>' do
    action do
      # sync library with device
    end
  end
  
end

Clive::Option::Runner.extend Alexandria::CLI::Helpers
a = Alexandria::CLI.run